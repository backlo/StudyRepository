# 오케스트레이션 기반 서비스 지향 아키텍처 스타일

## 토폴로지

아키텍처 내부에 서비스 택소노미를 정립하여 레이어별로 책임을 지운다는 아키텍처 스타일이다. 이는 최대한 모듈이나 기술, 즉 엔터프라이즈 레벨을 재사용함으로써 분산 시스템을 구축해 운영한다는 뜻이다.



## 택소노미

### 비즈니스 서비스

이 아키텍처의 최상단에 위치한 비즈니스 서비스는 진입접 역할을 한다. 이 서비스 정의는 코드는 전혀 업고, 입력, 출력, 스키마 정보만 갖고 있고 대부분 비즈니스 유저가 정의하기 때문에 이름도 비즈니스 서비스이다.

### 엔터프라이즈 서비스

엔터프라이즈 서비스는 세분화된 공유 구현체를 포함한다. 일반적으로 개발팀은 특정 비즈니스 도메인을 구현하는 업무를 하게 된다. 만약 개발자가 정확한 세분도에 맞게 엔터프라이즈 서비스를 구축할 수 없으면 비즈니스 워크플로의 해당 파트를 재작성해야 한다.

### 애플리케이션 서버스

애플리케이션 서비스는 한번만 사용 가능한 단일 구현체 서비스이다. 예를 들어 어떤 애플리케이션에 지리 공간 정보가 필요하지만 조직은 이걸 원하지 않을 때 어느 한 애플리케이션팀이 소유한 애플리케이션으로 서비스 문제를 해결하는 것이다. 

### 인프라 서비스

인프라 서비스는 모니터링, 로깅, 인증/인가 등의 운영 관심사를 지원한다.

### 오케스트레이션 엔진

오케스트레이션 엔진은 비즈니스 서비스 구현체를 서로 엮어주며 트랜잭션 조정과 메시지 변환 등의 기능을 수행한다. 마이크로 서비스 아키텍처처럼 서비스마다 데이터베이스가 잇는 것은 아니며, 일반적으로 단일 관계형 데이터베이스를 사용한다.

보통 오케스트레이션 엔진은 비즈니스와 엔터프라이즈 서비스의 관계, 이 둘을 매핑하는 방법, 트랜잭션 경계 범위 등을 정의한다. 또한 통합 허브 역할도 겸해 커스텀 코트를 패키지와 레거시 소프트웨어 시스템에 통합 시킬 수 있다. (이는 모두 오케스트레이션 엔진에 의존)

오케스트레이션 엔진의 문제점은 트랜잭션을 정확히 어느 레벨까지 세분화해야 할지 알아내기가 힘들다. 그렇기 때문에 이러한 레벨을 개발자가 직접 알아내야하기 때문에 아키텍처는 한층 더 복잡해졌다.

### 메시지 흐름

모든 요청은 오케스트레이션 엔진을 흘러간다. 이 말은 모든 로직이 오케스트레이션 엔진에 있어 커플링이 심하고 심지어 내부 호출 할 때에도 메시지는 엔진을 경유한다.

또한 서비스를 호출시 서비스 버스를 사용하는데 얘는 아키텍처 내부의 모든 호출을 중계하면서 통합 허브와 오케스트레이션 엔진, 두 가지 역할을 한다.



## 재사용, 그리고 커플링

이 아키텍처의 주된 목표는 서비스 레벨의 재사용, 즉 시간이 지남에 따라 재사용 가능한 비즈니스 행위를 점진적으로 구축하는 능력이다. 이는 다음과  같은 문제를 낳는다.

1. 재사용 위주로 시스템을 구축하다 보니 컴포넌트의 간의 커플링이 심하게 발생한다.
   * 서비스에서 무언가 하나만 바뀌어도 다른 곳에 여파가 일어나기 쉽다. -> 이러한 이유 때문에 점진적인 변화가 어렵다.
   * 따라서 배포를 조정하면서 전체적으로 테스트를 해봐야 하고 엔지니어링 효율 측면에서도 많은 난관에 봉착한다.
2. 로직을 한 곳에 통합하는 것 때문에 부가적인 정보 (쓸모 없는 것들 포함) 를 가지고 있어야한다.
   * 이는 다른 팀에서 복잡성까지 떠 안을 수 밖에 없는 구조를 만든다.
3. 여러 티어에 있는 수십 개 서비스와 단일 데이터베이스의 스키마 변경을 유발 할 수 있다.
4. 트랜잭션 세분도가 정확하게 정의되지 않는 경우, 자신의 설계를 변경하거나 거의 동일한 서비스를 새로 만들어 트랜잭셔널 로직을 바꿔야 한다.

즉 이러한 재사용성 목표로 인해 개발자가 할 일이 너무 많아진다.



## 아키텍처 특성 등급

| 아키텍처 특성 | 별점                     | 설명                                                         |
| ------------- | ------------------------ | ------------------------------------------------------------ |
| 분할 유형     | 기술                     |                                                              |
| 퀀텀 수       | 1                        | 단일 오케스트레이션 엔진이 거대한 커플링 지점 역할을 형성하기 때문에 |
| 배포성        | :star:                   | 제대로 지원 x                                                |
| 탄력성        | :star::star::star:       | 지원하지만 까다로움                                          |
| 진화성        | :star:                   |                                                              |
| 내고장성      | :star::star::star:       |                                                              |
| 모듈성        | :star::star::star:       |                                                              |
| 전체 비용     | :star:                   | 모든 팩터를 종합했을때, 비용이 엄청 많이 듦 (분산 트랜잭션 문제) |
| 성능          | :star::star:             |                                                              |
| 신뢰성        | :star::star:             |                                                              |
| 확장성        | :star::star::star::star: | 지원하지만 까다로움                                          |
| 단순성        | :star:                   | 모든 팩터를 종합했을때, 엄청 복잡함 (분산 트랜잭션 문제)     |
| 시험성        | :star:                   | 제대로 지원 x                                                |

 