# Chapter10 - 레이어드 아키텍처

## 토폴로지

레이어드 아키텍처에서 내부 컴포넌트는 논리적으로 수평한 레이어들로 구성되며, 각 레이어는 애플리케이션에서 주어진 역할을 수행한다.

레이어 개수와 유형은 특별히 제한이 없지만, 일반적으로 다음과 같이 구성한다.

1. 프레젠테이션 레이어
   * 모든 유저 인터페이스와 브라우저 통신 로직을 가짐
2. 비즈니스 레이어
   * 요청을 받아 알맞은 비즈니스 규칙을 실행
3. 퍼시스턴스 레이어
   * 데이터 CRUD
4. 데이터베이스 레이어
   * 데이터 관리 영역

보통 규모가 작으면 3개 크면 5개 그 이상으로 레이어를 나눈다. 그렇다면 어떻게 물리적으로 위 토폴로지를 나눌지 한번 보자.

1. 프레젠테이션, 비즈니스, 퍼시스턴스 -> 데이터베이스
   * 보통 외부에 별도로 분리된 물리적 데이터베이스를 나타냄
2. 프레젠테이션 -> 비즈니스, 퍼시스턴스 -> 데이터베이스 (?)
   * 프레젠테이션 레이어를 자체 배포
   * 비즈니스, 퍼시스턴스를 두 번째 배포 단위로 합한 것
3. 프레젠테이션, 비즈니스, 퍼시스턴스, 데이터베이스
   * 보통 인메모리 데이터베이스를 사용할 때 구성

레이어드 아키텍처는 개발자 본인의 기술 역량을 도메인의 기술적인 부분에 집중시킬 수 있지만, 변화에 민첩성이 떨어지는 트레이드 오프를 가지고 있다.

즉 **컴포넌트를 도메인 단위로 묶는 게 아니라, 아키텍처의 기술 역할에 따라 묶기 때문에 비즈니스 도메인이 각각 모든 아키텍처 레이어에 분산된다.**



## 레이어 격리

레이어드 아키텍처의 각 레이어는 **폐쇄** 또는 **개방**상태 이다.

* 폐쇄 레이어
  * 요청이 상위 레이어에서 하위 레이어로 이동하므로 중간의 어떤 레이어도 건너뛸 수 없고 현재 레이어를 거쳐야 바로 그 다음 레이어로 나아갈 수 있다는 뜻
  * 
* 개방 레이어
  * 폐쇄 레이어의 반대로 어느 레이어든 자유롭게 나아갈 수 있다는 뜻

레이어 격리는 어느 아키텍처 레이어에서 변경이 일어나도 다른 레이어에 있는 컴포넌트에 아무런 영향을 끼치지 않아야 한다라는 것이다. 즉 레이어 간 계약은 불변임을 의미한다.

레이어 격리를 지원하려면 요청의 메인 흐름에 관한 레이어가 반드시 폐쇄되어 있어야 한다. 이를 어길시 컴포넌트 간의 레이어 상호 의존도가 높아져서 단단히 커플링된 애플리케이션이 될 것이다. 또한 레이어를 격리하면 아키텍처의 모든 레이어를 다른 레이어에 영향을 주지 않고 교체할 수 있다.



## 레이어 추가

때로는 개방 레이어가 이득일 수 있다. 바로 공유 비즈니스 컴포넌트를 갖는 경우이다.

만약 공유 컴포넌트와 비즈니스 컴포넌트가 동일 계층에 있고 서로 사용한다면 지배/통제하기 어려운 아키텍처가 될 것이다. 그렇기에 공유 컴포넌트들을 따로 모은 공유 레이어를 새로 추가하고 이 레이어를 개방 레이어로 두면 복잡함이 해소된다.

개방/폐쇄 레이어 개념을 잘 활용하면 아키텍처 레이어 간 관계와 요청 흐름을 정의할 때 유용하다. 하지만 위 아키텍처를 문서화하여 소통하지 않으면 테스트, 유지 보수, 배포 작업이 아주 힘든, 단단히 커플링 되어 금방이라도 깨질 듯한 아키텍처가 될 것이다.



## 기타 고려 사항

레이어드 아키텍처는 싱크홀 안티패턴을 조심해야 한다.

* 싱크홀 안티패턴
  * 요청이 한 레이어에서 다른 레이어로 이동할 때 각 레이어가 아무 비즈니스 로직도 처리하지 않고 그냥 통과시키는 안티패턴
  * 불필요한 객체 초기화 및 처리를 빈번하게 유발
  * 쓸데없이 메모리를 소모하여 성능에 부정적인 영향을 끼침
  * 예를 들면 단순 조회 기능
  * 싱크홀 안티패턴을 피하는 방법
    * 적절한 조율 - 80 : 20 (싱크홀 안티패턴)
    * 혹은 아키텍처의 모든 레이어를 개방하는 방법



## 왜 이 아키텍처 스타일을 사용하는가

레이어드 아키텍처는 작고 단순한 애플리케이션이나 웹사이트에 알맞은 아키텍처 스타일이다. 그렇기에 처음 구축하거나, 예산과 일정이 빠듯한 경우 사용하면 좋다. 하지만 레이어드 아키텍처는 규모가 커질수록 특성이 나빠진다.



## 아키텍처 특성 등급

| 아키텍처 특성 | 별점                           | 설명                                                         |
| ------------- | ------------------------------ | ------------------------------------------------------------ |
| 분할 유형     | 기술                           |                                                              |
| 퀀텀 수       | 1                              |                                                              |
| 배포성        | :star:                         | 배포 절차가 까다로움, 코드를 3줄을 바꿔도 전체 빌드해야 하기 때문에 배포성이 떨어짐 |
| 탄력성        | :star:                         | 낮은 모듈성으로 인해 탄력성이 낮음                           |
| 진화성        | :star:                         | 낮은 모듈성으로 인해 진화성이 약함                           |
| 내고장성      | :star:                         | 분산아키텍처가 아니여서 내고장성이 낮음                      |
| 모듈성        | :star:                         | 모놀로식으로 구성되어 있음                                   |
| 전체 비용     | :star::star::star::star::star: | 단순하기 때문에 유지보수 비용이 적게 듬                      |
| 성능          | :star::star:                   | 병령처리가 안되고, 폐쇄적인 레이어 구조이기 때문에 성능이 낮음 |
| 신뢰성        | :star::star::star:             | 네트워크, 대역폭, 레이턴시 문제가 발생하지 않아 신뢰도가 보통 |
| 확장성        | :star:                         | 특정 지점까지 밖에 확장이 안됌                               |
| 단순성        | :star::star::star::star::star: | 복잡도가 낮고, 구조가 단순해서 알기 쉬움                     |
| 시험성        | :star::star:                   | 코드를 일부만 바꿔도 전체 테스트를 진행해야함                |

